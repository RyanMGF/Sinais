<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinais de Emoções</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            // darkMode is handled by a 'data-theme' attribute now
            theme: {
                extend: {
                    colors: {
                        'bg-primary': 'rgb(var(--color-bg-primary) / <alpha-value>)',
                        'bg-secondary': 'rgb(var(--color-bg-secondary) / <alpha-value>)',
                        'bg-tertiary': 'rgb(var(--color-bg-tertiary) / <alpha-value>)',
                        'bg-input': 'rgb(var(--color-bg-input) / <alpha-value>)',
                        'text-primary': 'rgb(var(--color-text-primary) / <alpha-value>)',
                        'text-secondary': 'rgb(var(--color-text-secondary) / <alpha-value>)',
                        'text-muted': 'rgb(var(--color-text-muted) / <alpha-value>)',
                        'border-primary': 'rgb(var(--color-border-primary) / <alpha-value>)',
                        'accent': 'rgb(var(--color-accent) / <alpha-value>)',
                        'accent-hover': 'rgb(var(--color-accent-hover) / <alpha-value>)',
                        'accent-text': 'rgb(var(--color-accent-text) / <alpha-value>)',
                        'accent-bg-light': 'rgb(var(--color-accent-bg-light) / <alpha-value>)',
                        'accent-text-dark': 'rgb(var(--color-accent-text-dark) / <alpha-value>)',
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Confetti for celebrations -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <!-- QUnit for Unit Testing -->
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.20.0.css">
    <script src="https://code.jquery.com/qunit/qunit-2.20.0.js"></script>

    <!-- SortableJS for Drag and Drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-bg-primary text-text-primary">

    <div id="app-container" class="max-w-lg mx-auto min-h-screen bg-bg-secondary shadow-lg flex flex-col">
        
        <!-- App Header -->
        <header id="app-header" class="p-4 border-b border-border-primary hidden">
            <h1 class="text-xl font-bold text-center text-text-primary"></h1>
        </header>

        <main class="flex-grow p-6 overflow-y-auto">
            <!-- Desktop Landing Screen has been moved to qr-code-screen -->

            <!-- Onboarding Screen -->
            <div id="onboarding-screen" class="screen flex flex-col justify-center h-full text-center">
                <div id="onboarding-content-wrapper" class="flex-grow flex flex-col items-center justify-center">
                    <div id="onboarding-icon-container" class="mb-6">
                        <i data-feather="heart" class="w-24 h-24 text-accent"></i>
                    </div>
                    <h2 id="onboarding-title" class="text-2xl md:text-3xl font-bold mb-3 text-text-primary"></h2>
                    <p id="onboarding-text" class="text-text-secondary max-w-md mx-auto"></p>
                </div>
                <div class="w-full pt-8 pb-4">
                    <div id="onboarding-dots" class="flex justify-center gap-2 mb-6"></div>
                    <div id="onboarding-nav" class="flex gap-4 w-full max-w-sm mx-auto">
                        <button id="onboarding-prev-btn" class="interactive-btn flex-1 px-6 py-3 bg-bg-tertiary text-text-primary rounded-full font-semibold hover:opacity-80 transition-all">Anterior</button>
                        <button id="onboarding-next-btn" class="interactive-btn flex-1 px-6 py-3 bg-accent text-accent-text rounded-full font-bold hover:bg-accent-hover transition-all">Próximo</button>
                    </div>
                </div>
            </div>

            <!-- Mandatory Contact Screen -->
            <div id="mandatory-contact-screen" class="screen">
                <div class="text-center">
                    <i data-feather="users" class="w-16 h-16 text-accent mx-auto mb-4"></i>
                    <h2 class="text-2xl font-bold mb-2">Sua Rede de Apoio</h2>
                    <p class="text-text-secondary mb-6">Adicionar pelo menos um contato de confiança é um passo importante. Em momentos difíceis, ter alguém para conversar pode fazer toda a diferença.</p>
                </div>
                <div id="mandatory-contacts-list" class="space-y-2 mb-6"></div>
                <div class="bg-bg-secondary p-4 rounded-lg border border-border-primary">
                    <h3 class="text-lg font-semibold mb-3">Adicionar Contato</h3>
                    <div class="flex items-center gap-2 mb-3">
                        <input type="text" id="mandatory-contact-name-input" class="w-1/2 p-3 border border-border-primary rounded-lg bg-bg-input" placeholder="Nome (Ex: Mãe)">
                        <input type="tel" id="mandatory-contact-phone-input" class="w-1/2 p-3 border border-border-primary rounded-lg bg-bg-input" placeholder="Telefone">
                    </div>
                    <button id="add-mandatory-contact-btn" class="interactive-btn w-full bg-bg-tertiary text-text-primary font-semibold py-2 px-4 rounded-lg hover:opacity-80 transition-all">
                        Adicionar
                    </button>
                </div>
                <button id="mandatory-contact-continue-btn" class="interactive-btn w-full bg-accent text-accent-text font-bold py-4 rounded-full shadow-lg mt-8 transition-all duration-300 opacity-50 cursor-not-allowed" disabled>
                    Continuar
                </button>
                <button id="skip-mandatory-contact-btn" class="interactive-btn w-full text-text-muted font-semibold py-2 mt-4 rounded-lg hover:text-accent transition-colors">
                    Pular por agora <span class="text-xs">(não recomendado)</span>
                </button>
            </div>

            <!-- Emotional Check-in Screen -->
            <div id="checkin-screen" class="screen text-center">
                <p class="text-lg text-text-secondary mb-8">Escolha a cor que melhor representa seu sentimento agora.</p>
                <div class="space-y-4">
                    <button data-mood="verde" class="interactive-btn mood-btn w-full bg-green-500 hover:bg-green-600 text-white font-bold py-6 rounded-xl shadow-md transition-transform transform hover:scale-105">
                        <i data-feather="smile" class="inline-block mr-2"></i> Siga em Frente
                    </button>
                    <button data-mood="amarelo" class="interactive-btn mood-btn w-full bg-amber-400 hover:bg-amber-500 text-white font-bold py-6 rounded-xl shadow-md transition-transform transform hover:scale-105">
                        <i data-feather="meh" class="inline-block mr-2"></i> Atenção
                    </button>
                    <button data-mood="vermelho" class="interactive-btn mood-btn w-full bg-red-500 hover:bg-red-600 text-white font-bold py-6 rounded-xl shadow-md transition-transform transform hover:scale-105">
                        <i data-feather="frown" class="inline-block mr-2"></i> Pare
                    </button>
                </div>
            </div>

            <!-- Check-in Details Screen -->
            <div id="details-screen" class="screen">
                <form id="details-form">
                    <div class="mb-6">
                        <label class="block text-lg font-semibold mb-2">Tags de Contexto</label>
                        <p class="text-sm text-text-muted mb-3">Selecione uma ou mais tags que se aplicam.</p>
                        <div id="predefined-tags-container" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div class="mb-6">
                        <label for="notes" class="block text-lg font-semibold mb-2">Notas (Opcional)</label>
                        <textarea id="notes" rows="5" class="w-full p-3 border border-border-primary rounded-lg focus:ring-2 focus:ring-accent transition bg-bg-input text-text-primary placeholder-text-muted" placeholder="O que aconteceu? Descreva a situação ou o sentimento."></textarea>
                    </div>
                    <button type="submit" id="save-checkin-btn" class="interactive-btn w-full text-accent-text font-bold py-4 rounded-full shadow-lg transition-all duration-300 bg-accent hover:shadow-xl transform hover:-translate-y-1">
                        Salvar Registro
                    </button>
                </form>
            </div>

            <!-- Feedback Screen -->
            <div id="feedback-screen" class="screen flex flex-col items-center justify-center h-full text-center">
                <i id="feedback-icon" data-feather="smile" class="w-20 h-20 text-accent mb-6"></i>
                <h2 id="feedback-title" class="text-3xl font-bold mb-4 text-text-primary">Que bom!</h2>
                <p id="feedback-message" class="text-text-secondary mb-8">É ótimo ver que você está se sentindo bem. Continue assim!</p>
                <button id="feedback-continue-btn" class="interactive-btn text-accent-text font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300">
                    Continuar
                </button>
            </div>

            <!-- Contextual Tips Screen -->
            <div id="contextual-tips-screen" class="screen">
                <h2 class="text-2xl font-bold mb-4 text-center">Dicas para seu Momento</h2>
                <p class="text-text-secondary mb-8 text-center">Com base no que você compartilhou, aqui estão algumas sugestões.</p>
                <div id="tips-container" class="space-y-6 mb-8">
                    <!-- Tips will be rendered here by JS -->
                </div>
                <button id="tips-continue-btn" class="interactive-btn w-full bg-accent text-accent-text font-bold py-3 px-8 rounded-full shadow-lg hover:bg-accent-hover transition-all duration-300">
                    Entendido
                </button>
            </div>

            <!-- Weekly Diagnosis Screen -->
            <div id="diagnosis-screen" class="screen">
                <h3 class="text-2xl font-bold mb-2 text-center">Diagnóstico Semanal</h3>
                <p class="text-text-muted text-center mb-8">Um resumo dos seus sentimentos nos últimos 7 dias.</p>
                
                <div id="diagnosis-content" class="hidden">
                    <div class="mb-8">
                        <h4 class="text-xl font-bold mb-4 text-center">Balanço da Semana</h4>
                        <canvas id="weekly-bar-chart"></canvas>
                    </div>
                    <div id="diagnosis-feedback" class="bg-bg-tertiary p-6 rounded-lg">
                        <h4 id="diagnosis-title" class="text-xl font-bold mb-3"></h4>
                        <p id="diagnosis-text" class="text-text-primary"></p>
                    </div>
                </div>
                <div id="no-diagnosis-data" class="text-center text-text-muted py-16 hidden">
                    <i data-feather="calendar" class="w-16 h-16 mx-auto mb-4"></i>
                    <p>Não há registros suficientes na última semana para gerar um diagnóstico.</p>
                </div>
            </div>

            <!-- Gratitude Journal Screen -->
            <div id="gratitude-journal-screen" class="screen">
                <h3 class="text-2xl font-bold mb-2 text-center">Diário de Gratidão</h3>
                <p class="text-text-muted text-center mb-8">Registre as coisas pelas quais você é grato(a) hoje.</p>
                <div class="mb-6">
                    <textarea id="new-gratitude-entry-input" rows="3" class="w-full p-3 border border-border-primary rounded-lg focus:ring-2 focus:ring-accent transition bg-bg-input text-text-primary placeholder-text-muted" placeholder="Hoje sou grato(a) por..."></textarea>
                    <button type="button" id="add-new-gratitude-entry-btn" class="interactive-btn w-full mt-3 bg-accent text-accent-text font-bold py-3 rounded-lg hover:bg-accent-hover transition-colors">
                        Adicionar Gratidão
                    </button>
                </div>
                <div id="gratitude-entries-list" class="space-y-3">
                    <!-- Entries will be rendered here -->
                </div>
            </div>

            <!-- Statistics Screen -->
            <div id="stats-screen" class="screen">
                <h3 class="text-2xl font-bold mb-8 text-center">Estatísticas Detalhadas</h3>
                <div id="stats-content" class="space-y-6">
                    <!-- General Stats -->
                    <div class="bg-bg-secondary p-4 rounded-lg border border-border-primary">
                        <h4 class="text-lg font-bold mb-2">Resumo da Jornada</h4>
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Total de Registros:</span>
                            <span id="stats-total-checkins" class="font-bold"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Primeiro Registro:</span>
                            <span id="stats-first-checkin" class="font-bold"></span>
                        </div>
                    </div>
                    <!-- Mood-Tag Correlations -->
                    <div id="stats-mood-tags" class="space-y-4"></div>
                </div>
                <div id="no-stats-data" class="text-center text-text-muted py-16 hidden">
                    <i data-feather="pie-chart" class="w-16 h-16 mx-auto mb-4 text-accent"></i>
                    <h4 class="text-xl font-bold text-text-primary mb-2">Ainda sem estatísticas</h4>
                    <p class="mb-6">Continue registrando suas emoções para desbloquear insights detalhados sobre seus padrões.</p>
                </div>_
            </div>

            <!-- Journey Hub Screen -->
            <div id="journey-screen" class="screen">
                <h3 class="text-2xl font-bold mb-8 text-center">Sua Jornada</h3>
                <div class="space-y-4">
                    <button data-screen="history-screen" class="interactive-btn journey-link w-full bg-bg-secondary p-6 rounded-lg border border-border-primary flex items-center justify-between hover:border-accent hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center gap-4">
                            <i data-feather="bar-chart-2" class="w-8 h-8 text-accent"></i>
                            <div>
                                <h4 class="text-lg font-bold text-left">Histórico</h4>
                                <p class="text-sm text-text-secondary text-left">Veja seus registros e padrões.</p>
                            </div>
                        </div>
                        <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                    </button>
                    <button data-screen="stats-screen" class="interactive-btn journey-link w-full bg-bg-secondary p-6 rounded-lg border border-border-primary flex items-center justify-between hover:border-accent hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center gap-4">
                            <i data-feather="pie-chart" class="w-8 h-8 text-accent"></i>
                            <div>
                                <h4 class="text-lg font-bold text-left">Estatísticas</h4>
                                <p class="text-sm text-text-secondary text-left">Insights sobre suas emoções.</p>
                            </div>
                        </div>
                        <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                    </button>
                    <button data-screen="diagnosis-screen" class="interactive-btn journey-link w-full bg-bg-secondary p-6 rounded-lg border border-border-primary flex items-center justify-between hover:border-accent hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center gap-4">
                            <i data-feather="compass" class="w-8 h-8 text-accent"></i>
                            <div>
                                <h4 class="text-lg font-bold text-left">Diagnóstico</h4>
                                <p class="text-sm text-text-secondary text-left">Análise do seu humor semanal.</p>
                            </div>
                        </div>
                        <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                    </button>
                    <button data-screen="achievements-screen" class="interactive-btn journey-link w-full bg-bg-secondary p-6 rounded-lg border border-border-primary flex items-center justify-between hover:border-accent hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center gap-4">
                            <i data-feather="star" class="w-8 h-8 text-accent"></i>
                            <div>
                                <h4 class="text-lg font-bold text-left">Conquistas</h4>
                                <p class="text-sm text-text-secondary text-left">Acompanhe seu progresso.</p>
                            </div>
                        </div>
                        <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                    </button>
                    <button data-screen="goals-screen" class="interactive-btn journey-link w-full bg-bg-secondary p-6 rounded-lg border border-border-primary flex items-center justify-between hover:border-accent hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center gap-4">
                            <i data-feather="target" class="w-8 h-8 text-accent"></i>
                            <div>
                                <h4 class="text-lg font-bold text-left">Metas</h4>
                                <p class="text-sm text-text-secondary text-left">Defina seus objetivos.</p>
                            </div>
                        </div>
                        <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                    </button>
                    <button data-screen="gratitude-journal-screen" class="interactive-btn journey-link w-full bg-bg-secondary p-6 rounded-lg border border-border-primary flex items-center justify-between hover:border-accent hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center gap-4">
                            <i data-feather="sun" class="w-8 h-8 text-accent"></i>
                            <div>
                                <h4 class="text-lg font-bold text-left">Diário de Gratidão</h4>
                                <p class="text-sm text-text-secondary text-left">Foque nos pontos positivos.</p>
                            </div>
                        </div>
                        <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                    </button>
                    <button data-screen="quote-screen" class="interactive-btn journey-link w-full bg-bg-secondary p-6 rounded-lg border border-border-primary flex items-center justify-between hover:border-accent hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300">
                        <div class="flex items-center gap-4">
                            <i data-feather="sunrise" class="w-8 h-8 text-accent"></i>
                            <div>
                                <h4 class="text-lg font-bold text-left">Frase do Dia</h4>
                                <p class="text-sm text-text-secondary text-left">Uma dose diária de inspiração.</p>
                            </div>
                        </div>
                        <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                    </button>
                </div>
            </div>

            <!-- Quote of the Day Screen -->
            <div id="quote-screen" class="screen flex flex-col items-center justify-center h-full text-center">
                <div class="w-full max-w-md">
                    <i data-feather="sunrise" class="w-16 h-16 text-accent mx-auto mb-6"></i>
                    <h3 class="text-2xl font-bold mb-8">Frase do Dia</h3>
                    <blockquote id="quote-text" class="text-xl lg:text-2xl font-semibold text-text-primary mb-4 italic">
                        <!-- Quote will be rendered here -->
                    </blockquote>
                    <p id="quote-author" class="text-text-secondary font-medium">— Autor Desconhecido</p>

                    <div class="mt-12">
                        <button id="toggle-add-quote-form-btn" class="interactive-btn text-accent font-semibold py-2 px-4 rounded-lg hover:bg-accent/10 transition-colors">
                            Adicionar sua frase
                        </button>
                        <div id="add-quote-form-container" class="hidden mt-4 p-4 bg-bg-tertiary rounded-lg text-left">
                            <h4 class="font-bold mb-3">Nova Frase Motivacional</h4>
                            <textarea id="new-quote-text-input" rows="3" class="w-full p-2 border border-border-primary rounded-lg bg-bg-input mb-2" placeholder="Escreva a frase aqui..."></textarea>
                            <input type="text" id="new-quote-author-input" class="w-full p-2 border border-border-primary rounded-lg bg-bg-input mb-3" placeholder="Autor (opcional)">
                            <div class="flex justify-end gap-2">
                                <button id="cancel-add-quote-btn" class="interactive-btn px-4 py-2 bg-bg-secondary text-text-primary rounded-lg hover:opacity-80">Cancelar</button>
                                <button id="save-new-quote-btn" class="interactive-btn px-4 py-2 bg-accent text-accent-text rounded-lg hover:bg-accent-hover">Salvar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Dashboard Screen -->
            <div id="history-screen" class="screen">
                <div id="calendar-view" class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month-btn" class="interactive-btn p-2 rounded-full hover:bg-bg-tertiary transition-colors"><i data-feather="chevron-left"></i></button>
                        <h3 id="calendar-month-year" class="text-xl font-bold capitalize"></h3>
                        <button id="next-month-btn" class="interactive-btn p-2 rounded-full hover:bg-bg-tertiary transition-colors"><i data-feather="chevron-right"></i></button>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center">
                        <!-- Calendar will be rendered here by JS -->
                    </div>
                </div>

                <div class="flex justify-end mb-4 -mt-4">
                    <button id="zen-mode-toggle" title="Modo Zen" class="flex items-center gap-2 text-text-muted hover:text-accent p-2 rounded-lg transition-colors">
                        <i data-feather="leaf"></i>
                        <span class="text-sm font-semibold">Modo Zen</span>
                    </button>
                </div>

                <div id="history-filter-container" class="mb-6" style="display: none;">
                    <h3 class="text-lg font-semibold mb-3 text-center">Filtrar por Tag</h3>
                    <div id="history-tags-filter" class="flex flex-wrap justify-center gap-2">
                        <!-- Filter tags will be rendered here by JS -->
                    </div>
                </div>
                <div id="history-content">
                    <div id="charts-container">
                        <div class="mb-8">
                            <h3 class="text-xl font-bold mb-4 text-center">Frequência de Emoções</h3>
                            <div class="max-w-xs mx-auto">
                                <canvas id="mood-pie-chart"></canvas>
                            </div>
                        </div>
                        <div id="tag-cloud-container" class="mb-8">
                            <!-- Tag cloud will be rendered here -->
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4 text-center">Registros Recentes</h3>
                        <div id="history-list" class="space-y-3"></div>
                    </div>
                </div>
                <div id="no-history" class="text-center text-text-muted py-16 hidden">
                    <i data-feather="archive" class="w-16 h-16 mx-auto mb-4 text-accent"></i>
                    <h4 class="text-xl font-bold text-text-primary mb-2">Seu histórico começa aqui</h4>
                    <p class="mb-6">Ao registrar suas emoções, você poderá ver seus padrões e progresso ao longo do tempo.</p>
                    <button class="interactive-btn go-to-checkin-btn bg-accent text-accent-text font-semibold py-2 px-6 rounded-full transition-transform">Registrar primeira emoção</button>
                </div>
            </div>

            <!-- Resource Library Screen -->
            <div id="resources-screen" class="screen">
                <div id="emergency-help-section" class="mb-8 p-6 rounded-lg bg-red-500/10 border border-red-500/20 text-center">
                    <h3 class="text-xl font-bold mb-2 text-red-600 dark:text-red-400">Ajuda Urgente</h3>
                    <p class="text-text-secondary mb-4">Se você está em uma crise, ligue para o Centro de Valorização da Vida (CVV).</p>
                    <a href="tel:188" class="w-full bg-red-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-red-600 transition-colors duration-300 flex items-center justify-center gap-3">
                        <i data-feather="phone-call"></i> Ligar para CVV - 188
                    </a>
                    <div id="favorite-contacts-container" class="w-full mt-6">
                        <!-- Favorite contacts will be rendered here -->
                    </div>
                    <div class="mt-6 pt-6 border-t border-red-500/20">
                        <h3 class="text-lg font-semibold mb-3 text-left">Adicionar Novo Contato</h3>
                        <div class="flex items-center gap-2 mb-3">
                            <input type="text" id="resources-contact-name-input" class="w-1/2 p-3 border border-border-primary rounded-lg bg-bg-input text-text-primary" placeholder="Nome">
                            <input type="tel" id="resources-contact-phone-input" class="w-1/2 p-3 border border-border-primary rounded-lg bg-bg-input text-text-primary" placeholder="Telefone">
                        </div>
                        <button id="add-resources-contact-btn" class="interactive-btn w-full bg-accent text-accent-text font-semibold py-2 px-4 rounded-lg hover:bg-accent-hover transition-opacity">
                            Adicionar à Rede
                        </button>
                    </div>
                </div>
                <div id="suggested-resources" class="mb-8"></div>
                <div id="all-resources">
                    <h3 class="text-xl font-bold mb-4">Biblioteca Completa</h3>
                    <div id="resources-list" class="space-y-4"></div>
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="settings-screen" class="screen">
                <h3 class="text-xl font-bold mb-6">Configurações</h3>
                <div class="space-y-4">
                    <div class="bg-bg-secondary p-4 rounded-lg border border-border-primary">
                        <h4 class="text-lg font-bold mb-4">Tema</h4>
                        <div id="theme-selector" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                            <button data-theme="auto" class="interactive-btn theme-btn p-3 rounded-lg border-2 border-border-primary transition-all">Automático</button>
                            <button data-theme="light" class="interactive-btn theme-btn p-3 rounded-lg border-2 border-border-primary transition-all">Claro</button>
                            <button data-theme="dark" class="interactive-btn theme-btn p-3 rounded-lg border-2 border-border-primary transition-all">Escuro</button>
                            <button data-theme="ocean" class="interactive-btn theme-btn p-3 rounded-lg border-2 border-border-primary transition-all">Oceano</button>                            
                            <button data-theme="nature" class="interactive-btn theme-btn p-3 rounded-lg border-2 border-border-primary transition-all">Natureza</button>
                        </div>
                    </div>
                    <div class="bg-bg-secondary p-4 rounded-lg border border-border-primary flex justify-between items-center">
                        <div>
                            <h4 class="text-lg font-bold">Modo Foco</h4>
                            <p class="text-sm text-text-secondary">Desativa vibrações e pop-ups.</p>
                        </div>
                        <button id="focus-mode-toggle" role="switch" aria-checked="false" class="toggle-switch relative inline-flex items-center h-6 rounded-full w-11 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent">
                            <span class="inline-block w-4 h-4 transform bg-white rounded-full transition-transform"></span>
                        </button>
                    </div>
                    <div class="bg-bg-secondary p-4 rounded-lg border border-border-primary">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="text-lg font-bold">Lembrete Diário</h4>
                                <p class="text-sm text-text-secondary">Receba uma notificação para seu check-in.</p>
                            </div>
                            <button id="reminder-toggle" role="switch" aria-checked="false" class="toggle-switch relative inline-flex items-center h-6 rounded-full w-11 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent">
                                <span class="inline-block w-4 h-4 transform bg-white rounded-full transition-transform"></span>
                            </button>
                        </div>
                        <div id="reminder-time-container" class="mt-4 hidden">
                            <input type="time" id="reminder-time-input" class="w-full p-2 border border-border-primary rounded-lg bg-bg-input text-text-primary">
                        </div>
                    </div>
                    <div class="bg-bg-secondary p-4 rounded-lg border border-border-primary">
                        <h4 class="text-lg font-bold">Gerenciar Dados</h4>
                        <p class="text-sm text-text-secondary my-2">Guarde um backup seguro dos seus registros ou importe dados de outro dispositivo.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4">
                            <button id="export-data-btn" class="interactive-btn w-full bg-accent/80 text-accent-text font-semibold py-2 px-4 rounded-lg hover:bg-accent/100 transition-all flex items-center justify-center gap-2">
                                <i data-feather="download"></i>
                                Exportar Dados
                            </button>
                            <button id="import-data-btn" class="interactive-btn w-full bg-bg-tertiary text-text-primary font-semibold py-2 px-4 rounded-lg hover:opacity-80 transition-all flex items-center justify-center gap-2">
                                <i data-feather="upload"></i>
                                Importar Dados
                            </button>
                        </div>
                        <input type="file" id="import-file-input" class="hidden" accept="application/json">
                    </div>

                    <div class="bg-bg-secondary p-4 rounded-lg border border-border-primary" id="qr-code-button-container">
                        <button id="go-to-qr-screen-btn" class="interactive-btn w-full flex items-center justify-between text-left p-2 rounded-lg hover:bg-bg-tertiary">
                            <div class="flex items-center gap-4">
                                <i data-feather="smartphone" class="w-6 h-6 text-accent"></i>
                                <div>
                                    <h4 class="text-lg font-bold">Acessar no Celular</h4>
                                    <p class="text-sm text-text-secondary">Use o app no seu smartphone.</p>
                                </div>
                            </div>
                            <i data-feather="chevron-right" class="w-6 h-6 text-text-muted"></i>
                        </button>
                    </div>

                    <div class="mt-8">
                        <h4 class="text-lg font-bold mb-4">Gerenciar Tags</h4>
                        <div class="flex items-center gap-2 mb-4">
                            <input type="text" id="new-tag-input" class="w-full p-3 border border-border-primary rounded-lg focus:ring-2 focus:ring-accent transition bg-bg-input text-text-primary placeholder-text-muted" placeholder="Adicionar nova tag...">
                            <button type="button" id="add-new-tag-btn" class="interactive-btn bg-accent text-accent-text p-3 rounded-lg hover:bg-accent-hover transition-colors flex-shrink-0">
                                <i data-feather="plus"></i>
                            </button>
                        </div>
                        <div id="tag-management-list" class="space-y-2">
                            <!-- Tags will be rendered here by JS -->
                        </div>
                    </div>

                </div>
            </div>

            <!-- Achievements Screen -->
            <div id="achievements-screen" class="screen">
                <h3 class="text-2xl font-bold mb-2 text-center">Minhas Conquistas</h3>
                <p class="text-text-muted text-center mb-8">Continue registrando para desbloquear todas!</p>
                <div id="achievements-list" class="grid grid-cols-2 gap-4">
                    <!-- Achievements will be rendered here -->
                </div>
            </div>

            <!-- Goals Screen -->
            <div id="goals-screen" class="screen">
                <h3 class="text-2xl font-bold mb-2 text-center">Minhas Metas</h3>
                <p class="text-text-muted text-center mb-8">Defina objetivos para seu bem-estar emocional.</p>
                <div class="flex items-center gap-2 mb-6">
                    <input type="text" id="new-goal-input" class="w-full p-3 border border-border-primary rounded-lg focus:ring-2 focus:ring-accent transition bg-bg-input text-text-primary placeholder-text-muted" placeholder="Ex: Meditar 5 minutos por dia">
                    <button type="button" id="add-new-goal-btn" class="interactive-btn bg-accent text-accent-text p-3 rounded-lg hover:bg-accent-hover transition-colors flex-shrink-0">
                        <i data-feather="plus"></i>
                    </button>
                </div>
                <div id="goals-list" class="space-y-3">
                    <!-- Goals will be rendered here -->
                </div>
                <div class="mt-12">
                    <button id="toggle-archived-goals-btn" class="interactive-btn w-full flex justify-between items-center p-4 bg-bg-tertiary rounded-lg transition-all">
                        <span class="font-semibold text-text-secondary">Metas Arquivadas</span>
                        <i data-feather="chevron-down" id="archived-goals-chevron" class="text-text-secondary transition-transform"></i>
                    </button>
                    <div id="archived-goals-container" class="hidden mt-4 space-y-3">
                    </div>
                </div>
            </div>

        </main>

        <!-- Bottom Navigation Bar -->
        <nav class="w-full max-w-lg mx-auto bg-bg-secondary border-t border-border-primary fixed bottom-0 left-0 right-0">
            <div id="bottom-nav" class="relative flex justify-around hidden">
                <div id="nav-indicator" style="left: 12.5%;"></div>
                <button data-screen="checkin-screen" class="nav-btn flex-1 py-3 text-center text-text-muted transition-colors">
                    <i data-feather="home" class="mx-auto"></i><span class="text-xs block">Início</span>
                </button>
                <button data-screen="journey-screen" class="nav-btn flex-1 py-3 text-center text-text-muted transition-colors">
                    <i data-feather="trending-up" class="mx-auto"></i><span class="text-xs block">Jornada</span>
                </button>
                <button data-screen="resources-screen" class="nav-btn flex-1 py-3 text-center text-text-muted transition-colors">
                    <i data-feather="book-open" class="mx-auto"></i><span class="text-xs block">Recursos</span>
                </button>
                <button data-screen="settings-screen" class="nav-btn flex-1 py-3 text-center text-text-muted transition-colors">
                    <i data-feather="settings" class="mx-auto"></i><span class="text-xs block">Ajustes</span>
                </button>
            </div>
        </nav>
        
        <!-- Spacer to prevent content from being hidden by the nav bar -->
        <div id="nav-spacer" class="h-20 hidden"></div>

        <!-- Edit Modal -->
        <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
            <div id="edit-modal-content" class="bg-bg-secondary rounded-lg shadow-xl w-full max-w-md p-6">
                <h3 class="text-xl font-bold mb-4">Editar Registro</h3>
                <form id="edit-form">
                    <div class="mb-6">
                        <label for="edit-notes" class="block text-lg font-semibold mb-2">Notas</label>
                        <textarea id="edit-notes" rows="5" class="w-full p-3 border border-border-primary rounded-lg focus:ring-2 focus:ring-accent transition bg-bg-input text-text-primary placeholder-text-muted"></textarea>
                    </div>
                    <div class="mb-6">
                        <label class="block text-lg font-semibold mb-2">Tags</label>
                        <div id="edit-predefined-tags-container" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div class="flex justify-end gap-4">
                        <button type="button" id="cancel-edit-btn" class="interactive-btn px-6 py-2 bg-bg-tertiary text-text-primary rounded-lg hover:opacity-80 transition-all">Cancelar</button>
                        <button type="submit" id="save-edit-btn" class="interactive-btn px-6 py-2 bg-accent text-accent-text rounded-lg hover:bg-accent-hover transition-all">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Achievement Unlocked Modal -->
        <div id="achievement-unlocked-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
            <div id="achievement-modal-content" class="bg-bg-secondary rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
                <i data-feather="award" class="w-16 h-16 text-accent mx-auto mb-4"></i>
                <h3 class="text-2xl font-bold mb-2">Conquista Desbloqueada!</h3>
                <p id="unlocked-achievement-title" class="text-lg font-semibold text-accent"></p>
                <p id="unlocked-achievement-desc" class="text-text-secondary mb-6"></p>
                <button id="close-achievement-modal-btn" class="interactive-btn w-full bg-accent text-accent-text font-bold py-2 px-4 rounded-lg hover:bg-accent-hover transition-all">
                    Legal!
                </button>
            </div>
        </div>

        <!-- Icon Picker Modal -->
        <div id="icon-picker-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
            <div class="bg-bg-secondary rounded-lg shadow-xl w-full max-w-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Escolha um Ícone</h3>
                    <button id="close-icon-picker-btn" class="p-1 rounded-full hover:bg-bg-tertiary"><i data-feather="x"></i></button>
                </div>
                <div id="icon-picker-grid" class="grid grid-cols-5 sm:grid-cols-6 gap-4 max-h-64 overflow-y-auto">
                    <!-- Icons will be rendered here by JS -->
                </div>
            </div>
        </div>


        <!-- Gratitude Edit Modal -->
        <div id="gratitude-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
            <div id="gratitude-edit-modal-content" class="bg-bg-secondary rounded-lg shadow-xl w-full max-w-md p-6">
                <h3 class="text-xl font-bold mb-4">Editar Gratidão</h3>
                <form id="gratitude-edit-form">
                    <div class="mb-6">
                        <textarea id="edit-gratitude-text" rows="5" class="w-full p-3 border border-border-primary rounded-lg focus:ring-2 focus:ring-accent transition bg-bg-input text-text-primary placeholder-text-muted"></textarea>
                    </div>
                    <div class="flex justify-end gap-4">
                        <button type="button" id="cancel-gratitude-edit-btn" class="interactive-btn px-6 py-2 bg-bg-tertiary text-text-primary rounded-lg hover:opacity-80 transition-all">Cancelar</button>
                        <button type="submit" id="save-gratitude-edit-btn" class="interactive-btn px-6 py-2 bg-accent text-accent-text rounded-lg hover:bg-accent-hover transition-all">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

            <!-- QR Code Screen (replaces Desktop Landing Screen) -->
            <div id="qr-code-screen" class="screen flex flex-col items-center justify-center h-full p-4 md:p-8">
                <div class="w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <!-- Coluna Esquerda: QR Code e Ação -->
                    <div class="text-center order-2 md:order-1">
                        <i data-feather="smartphone" class="w-16 h-16 text-accent mx-auto mb-4"></i>
                        <h2 class="text-3xl font-bold mb-2 text-text-primary">Venha testar o Sinal de Emoções!</h2>
                        <p class="text-text-secondary mb-6">Aponte a câmera do seu celular para o QR Code e tenha a experiência completa.</p>
                        
                        <div class="flex justify-center mb-4">
                            <img id="qr-code-img" src="qr-code.png" alt="QR Code para acessar no celular" class="w-56 h-56 rounded-lg border-4 border-accent p-1 bg-white">
                        </div>

                        <p class="text-sm text-text-muted mb-6">Seu computador e celular precisam estar na mesma rede Wi-Fi.</p>
                    </div>

                    <!-- Coluna Direita: Marcador de Página com a História -->
                    <div class="order-1 md:order-2 bg-bg-secondary border-2 border-border-primary rounded-xl shadow-lg p-6 h-full flex flex-col">
                        <div class="text-center mb-4">
                            <img src="logo-escola-placeholder.png" alt="Logo da Escola" class="h-16 mx-auto mb-2">
                            <h3 class="font-bold text-lg text-text-primary">Colégio Estadual da Prata</h3>
                        </div>
                        <div class="flex-grow text-text-secondary space-y-4 text-sm">
                            <h4 class="font-bold text-text-primary text-base">Nossa História</h4>
                            <p>O "Sinal de Emoções" nasceu da necessidade de criar um espaço seguro para o diálogo sobre saúde mental. Inspirado em metodologias de autoconhecimento, este aplicativo foi pensado para ser uma ferramenta simples e acessível, ajudando usuários a identificar e compreender seus sentimentos diários.</p>
                            
                            <h4 class="font-bold text-text-primary text-base mt-4">Participantes do Projeto</h4>
                            <ul class="list-none space-y-2">
                                <li class="flex items-center gap-2"><i data-feather="user" class="w-4 h-4 text-accent"></i><span><strong>Professor:</strong> Renato</span></li>
                                <li class="flex items-center gap-2"><i data-feather="user" class="w-4 h-4 text-accent"></i><span><strong>Aluna:</strong> Emilly</span></li>
                                <li class="flex items-center gap-2"><i data-feather="user" class="w-4 h-4 text-accent"></i><span><strong>Aluna:</strong> Sophia</span></li>
                            </ul>
                        </div>
                        <div class="border-t border-border-primary mt-4 pt-3 text-center text-xs text-text-muted">
                            Um projeto de tecnologia e bem-estar.
                        </div>
                    </div>
                </div>
            </div>

        <!-- Guided Tour Overlay -->
        <div id="tour-overlay" class="fixed inset-0 z-[100] hidden">
            <div id="tour-spotlight"></div>
            <div id="tour-tooltip" class="absolute bg-bg-secondary p-5 rounded-xl shadow-2xl w-80 max-w-[90vw]">
                <h4 id="tour-title" class="font-bold text-lg mb-2 text-text-primary"></h4>
                <p id="tour-text" class="text-sm text-text-secondary mb-4"></p>
                <div class="flex justify-between items-center">
                    <button id="tour-skip-btn" class="interactive-btn text-sm font-semibold text-text-muted hover:text-accent transition-colors">Pular Tour</button>
                    <div class="flex items-center gap-3">
                        <span id="tour-step-indicator" class="text-sm font-semibold text-text-muted"></span>
                        <button id="tour-next-btn" class="interactive-btn bg-accent text-accent-text font-semibold py-2 px-5 rounded-lg hover:bg-accent-hover transition-colors">
                            Próximo
                        </button>
                    </div>
                </div>
                <div class="w-full bg-bg-tertiary rounded-full h-1 mt-4"><div id="tour-progress-bar" class="bg-accent h-1 rounded-full"></div></div>
            </div>
        </div>
    </div>

    <!-- Test Runner Display Area -->
    <div id="qunit-container" class="max-w-lg mx-auto p-4" style="display: none;">
        <h2 class="text-2xl font-bold mb-4 text-text-primary">Testes Unitários da Lógica de Dados</h2>
        <div id="qunit"></div>
        <div id="qunit-fixture"></div>
    </div>

    <!-- ====================================================================== -->
    <!-- ======================= JAVASCRIPT MODULES ======================= -->
    <!-- ====================================================================== -->
                
    <!-- Main Application Script -->
    <script src="app.js"></script>

    <!-- ====================================================================== -->
    <!-- ======================= UNIT TEST SCRIPT ========================= -->
    <!-- ====================================================================== -->
    <script>
        // To run tests, append "?test" to the URL.
        if (new URLSearchParams(window.location.search).has('test')) {
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('qunit-container').style.display = 'block';

            QUnit.module('Data Logic: calculateStreaks', function() {
                const createCheckin = (daysAgo) => {
                    const date = new Date();
                    date.setDate(date.getDate() - daysAgo);
                    return { createdAt: date };
                };

                QUnit.test('should return 0 for current and longest with no checkins', function(assert) {
                    const result = calculateStreaks([]);
                    assert.deepEqual(result, { current: 0, longest: 0 }, 'Correctly handles empty array');
                });

                QUnit.test('should calculate a single day streak', function(assert) {
                    const checkins = [createCheckin(0)]; // Today
                    const result = calculateStreaks(checkins);
                    assert.deepEqual(result, { current: 1, longest: 1 }, 'Correctly handles a single checkin today');
                });

                QUnit.test('should calculate a current streak of 3 days', function(assert) {
                    const checkins = [createCheckin(0), createCheckin(1), createCheckin(2)];
                    const result = calculateStreaks(checkins);
                    assert.deepEqual(result, { current: 3, longest: 3 }, 'Correctly calculates a 3-day current streak');
                });

                QUnit.test('should handle multiple checkins on the same day', function(assert) {
                    const checkins = [createCheckin(0), createCheckin(0), createCheckin(1), createCheckin(1), createCheckin(2)];
                    const result = calculateStreaks(checkins);
                    assert.deepEqual(result, { current: 3, longest: 3 }, 'Counts multiple checkins on the same day as one');
                });

                QUnit.test('should identify a broken streak', function(assert) {
                    const checkins = [createCheckin(2), createCheckin(3), createCheckin(4)]; // Last checkin was 2 days ago
                    const result = calculateStreaks(checkins);
                    assert.deepEqual(result, { current: 0, longest: 3 }, 'Current streak is 0, longest is 3');
                });

                QUnit.test('should correctly identify longest streak when there are multiple streaks', function(assert) {
                    const checkins = [
                        createCheckin(0), createCheckin(1), // Current streak: 2
                        createCheckin(5), createCheckin(6), createCheckin(7) // Past streak: 3
                    ];
                    const result = calculateStreaks(checkins);
                    assert.deepEqual(result, { current: 2, longest: 3 }, 'Correctly identifies longest streak');
                });

                QUnit.test('should handle streak crossing a month boundary', function(assert) {
                    // Simulate checkins for today (e.g., 2nd of a month) and yesterday (1st of a month)
                    const today = new Date();
                    const yesterday = new Date();
                    yesterday.setDate(today.getDate() - 1);
                    const dayBefore = new Date();
                    dayBefore.setDate(today.getDate() - 2);

                    const checkins = [{ createdAt: today }, { createdAt: yesterday }, { createdAt: dayBefore }];
                    const result = calculateStreaks(checkins);
                    assert.deepEqual(result, { current: 3, longest: 3 }, 'Correctly handles streak over month/year boundary');
                });
            });
        }
    </script>

</body>
</html>
                